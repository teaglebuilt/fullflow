version: '3.5'
services:
  server:
    build:
      context: containers/server
    image: jupyterlab
    container_name: jupyterlab
    ports:
     - "9888:8888"
    volumes:
     - ./:/opt/dev/
    environment:
      KG_URL: http://0.0.0.0:8888
      KG_AUTH_TOKEN: poop
    command: >
      jupyter lab
      --NotebookApp.ip=0.0.0.0
      --NotebookApp.session_manager_class=nb2kg.managers.SessionManager
      --NotebookApp.kernel_manager_class=nb2kg.managers.RemoteKernelManager
      --NotebookApp.kernel_spec_manager_class=nb2kg.managers.RemoteKernelSpecManager
      --allow-root

  kernel_gateway:
    build:
      context: containers/gateway
    image: kernel-gateway
    container_name: gateway
    ports:
     - "9889:8888"
    volumes:
     - ./:/opt/dev/
    environment:
      KG_ALLOW_ORIGIN: '*'
      KG_LIST_KERNELS: "True"
      KG_AUTH_TOKEN: poop
    command: >
      jupyter kernelgateway
      --KernelGatewayApp.ip=0.0.0.0
      --KernelGatewayApp.log_level=DEBUG

  # webserver:
  #   image: teaglebuilt/fullflow:local
  #   restart: always
  #   depends_on:
  #     - postgres
  #   volumes:
  #     - ./dags:/usr/local/airflow/dags
  #     - ./src:/usr/local/airflow/src
  #     - ./logs:/usr/local/airflow/logs
  #   ports:
  #     - 8099:8080
  #   env_file: .env
  #   environment:
  #     - ENVIRONMENT=docker
  #   networks:
  #     - fullflow
  #   command: webserver

  # scheduler:
  #   image: teaglebuilt/fullflow:local
  #   restart: always
  #   depends_on:
  #     - webserver
  #   volumes:
  #     - ./dags:/usr/local/airflow/dags
  #     - ./src:/usr/local/airflow/src
  #     - ./logs:/usr/local/airflow/logs
  #   env_file: .env
  #   environment:
  #     - ENVIRONMENT=docker
  #   command: scheduler

  # postgres:
  #   image: bitnami/postgresql:latest
  #   hostname: postgres
  #   environment:
  #     - POSTGRES_USER=airflow
  #     - POSTGRES_PASSWORD=postgresql
  #     - POSTGRES_DB=airflow
  #   ports:
  #     - 5432:5432